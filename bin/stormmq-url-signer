#!/usr/bin/env ruby
#
# Copyright (c) 2010, Tony Byrne & StormMQ Ltd.
# All rights reserved.
#
# Please refer to the LICENSE file that accompanies this source
# for terms of use and redistribution.


$:.unshift File.dirname(__FILE__) + '/../lib'
require 'rubygems'
require 'commandline'
require 'commandline/optionparser'
require 'stormmq'

class StormMQURLSigner < CommandLine::Application

  def initialize
    author    "Tony Byrne"
    copyright "Tony Byrne, 2010"
    synopsis  "--user USER [--method METHOD] --url URL"
    short_description "Signs a URL for use with StormMQ's RESTful API"
    long_description  ""
    options :help

    option  :names           => %w(--user -u),
            :opt_description => "a valid StormMQ user name",
            :arity           => [1,1],
            :opt_found       => get_args,
            :opt_not_found   => CommandLine::OptionParser::OPT_NOT_FOUND_BUT_REQUIRED

    option  :names           => %w(--method -m),
            :opt_description => "the HTTP method to use - defaults to 'GET'",
            :arity           => [0,1],
            :opt_found       => get_args,
            :opt_not_found   => 'GET'

    option  :names           => %w(--url -a),
            :opt_description => "the URL to be signed",
            :arity           => [1,1],
            :opt_found       => get_args,
            :opt_not_found   => CommandLine::OptionParser::OPT_NOT_FOUND_BUT_REQUIRED
  end

  def main
    puts StormMQ::URLSigner.sign(opt.url, :method => opt['--method'], :user => opt.user)
  end

end

__END__
